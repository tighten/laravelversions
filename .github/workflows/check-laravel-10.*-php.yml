name: 10.* Checks

on:
  workflow_dispatch:
  schedule:
    - cron: '0 0 1 * *'

jobs:
  test:
    strategy:
      fail-fast: false
      matrix:
        laravel:
        - ["10.*", "8.2"]
        - ["10.*", "8.1"]
        - ["10.*", "8.0"]
        - ["10.*", "7.4"]
        - ["10.*", "7.3"]
        - ["10.*", "7.2"]
        - ["10.*", "7.1"]
        - ["10.*", "7.0"]
        - ["10.*", "5.6"]
        - ["10.*", "5.5"]
        - ["10.*", "5.4"]

    name: Laravel ${{ matrix.laravel[0] }} | PHP ${{ matrix.laravel[1] }}

    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v3
      - uses: actions/cache@v3
        with:
          path: ~/.composer/cache/files
          key: laravel-${{ matrix.laravel[0] }}-php-${{ matrix.laravel[1] }}
      - uses: shivammathur/setup-php@v2
        with:
          php-version: ${{ matrix.laravel[1] }}
      - run: |
          composer create-project --no-install --no-scripts laravel/laravel="${{ matrix.laravel[0] }}" laravel
          cd laravel
          composer config --no-interaction allow-plugins.kylekatarnls/update-helper true
          composer install
          php -r "file_exists('.env') || copy('.env.example', '.env');"
          php artisan key:generate --ansi
          vendor/bin/phpunit
